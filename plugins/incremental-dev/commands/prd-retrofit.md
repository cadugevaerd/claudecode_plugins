---
description: Criar PRD retroativo para projeto existente - analisa c√≥digo e gera documenta√ß√£o baseada na realidade
---

# PRD Retrofit (Criar PRD Retroativo)

Este comando cria um **Product Requirements Document (PRD) retroativo** para projetos que j√° foram desenvolvidos mas nunca tiveram documenta√ß√£o formal de requisitos.

## üéØ Objetivo

Gerar PRD baseado em c√≥digo existente:
- Analisar c√≥digo-fonte para extrair funcionalidades
- Documentar decis√µes arquiteturais implementadas
- Criar hist√≥rico de evolu√ß√£o (via git)
- Estabelecer baseline para futuras evolu√ß√µes

**Diferen√ßa para `/adopt-incremental`**:
- `/adopt-incremental`: An√°lise COMPLETA + PRD + CLAUDE.md + Roadmap
- `/prd-retrofit`: Apenas cria PRD retroativo (sem configurar YAGNI)

## üìã Como usar

```bash
# An√°lise completa autom√°tica
/prd-retrofit

# Com descri√ß√£o do projeto
/prd-retrofit "Sistema de gerenciamento de estoque"

# Especificar vers√£o do PRD
/prd-retrofit --version 2.5.0
```

## üîç Processo de Execu√ß√£o

### Passo 1: Detectar Vers√£o do Projeto

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìÑ CRIAR PRD RETROATIVO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Detectando vers√£o do projeto...
```

**1.1. Procurar vers√£o em arquivos comuns**:

```python
# Verificar em ordem:
1. pyproject.toml ‚Üí [tool.poetry.version] ou [project.version]
2. setup.py ‚Üí version="X.Y.Z"
3. __init__.py ‚Üí __version__ = "X.Y.Z"
4. package.json ‚Üí "version": "X.Y.Z"
5. git tags ‚Üí √∫lti git tag mais recente
```

**Output**:
```
‚úÖ Vers√£o detectada: 2.5.0

Fonte: pyproject.toml
PRD ser√° criado como v2.5.0
```

**Se vers√£o N√ÉO detectada**:
```
‚ö†Ô∏è  Vers√£o n√£o detectada automaticamente

Sugest√µes:
1. Contar commits: [X] commits ‚Üí v0.[X].0
2. Usar data: YYYY.MM.DD
3. Iniciar em v1.0.0

Qual vers√£o usar? (ou pressione Enter para v1.0.0)
```

---

### Passo 2: Analisar Estrutura do C√≥digo

```
üìä Analisando estrutura do projeto...

[Progresso]
‚îú‚îÄ Lendo arquivos fonte...
‚îú‚îÄ Detectando funcionalidades...
‚îú‚îÄ Analisando arquitetura...
‚îî‚îÄ Extraindo decis√µes t√©cnicas...
```

**2.1. Detectar Framework/Stack**:

```python
# Identificar automaticamente:
- FastAPI: from fastapi import...
- Django: django.conf, models.py
- Flask: from flask import...
- LangChain: from langchain import...
- CLI: argparse, click, typer
```

**Output**:
```
üîß Stack Detectada:

Framework Web: FastAPI v0.104.0
ORM: SQLAlchemy v2.0.0
Valida√ß√£o: Pydantic v2.5.0
Testing: pytest v7.4.0
```

**2.2. Mapear Funcionalidades**:

Analisar c√≥digo para extrair funcionalidades:

```python
# Estrat√©gias por framework:

# FastAPI: Endpoints
@app.get("/users") ‚Üí "Listar usu√°rios"
@app.post("/users") ‚Üí "Criar usu√°rio"

# Django: Views
def user_list(request) ‚Üí "Listar usu√°rios"
class UserCreateView ‚Üí "Criar usu√°rio"

# CLI: Commands
@click.command("migrate") ‚Üí "Migrar banco de dados"

# LangChain: Chains/Agents
chain = prompt | llm | parser ‚Üí "Pipeline de processamento"
```

**Output**:
```
üéØ Funcionalidades Identificadas:

1. Autentica√ß√£o e Autoriza√ß√£o
   ‚îú‚îÄ POST /auth/login ‚Üí Login de usu√°rio
   ‚îú‚îÄ POST /auth/logout ‚Üí Logout de usu√°rio
   ‚îú‚îÄ POST /auth/refresh ‚Üí Refresh de token
   ‚îî‚îÄ GET /auth/me ‚Üí Obter usu√°rio atual

2. Gerenciamento de Usu√°rios
   ‚îú‚îÄ GET /users ‚Üí Listar usu√°rios (paginado)
   ‚îú‚îÄ POST /users ‚Üí Criar usu√°rio
   ‚îú‚îÄ GET /users/{id} ‚Üí Obter usu√°rio espec√≠fico
   ‚îú‚îÄ PUT /users/{id} ‚Üí Atualizar usu√°rio
   ‚îî‚îÄ DELETE /users/{id} ‚Üí Deletar usu√°rio

3. Gerenciamento de Produtos
   ‚îú‚îÄ GET /products ‚Üí Listar produtos
   ‚îú‚îÄ POST /products ‚Üí Criar produto
   ‚îî‚îÄ PUT /products/{id} ‚Üí Atualizar produto

Total: 12 endpoints / 3 m√≥dulos principais
```

**2.3. Extrair Decis√µes Arquiteturais**:

Identificar padr√µes e decis√µes via c√≥digo:

```python
# Detectar:
1. Padr√µes de design (Repository, Factory, Strategy)
2. Estrutura de diret√≥rios (Clean Architecture, MVC)
3. Bibliotecas importantes (ORM, valida√ß√£o, auth)
4. Configura√ß√µes (env vars, configs)
```

**Output**:
```
üèóÔ∏è  Arquitetura Detectada:

Padr√£o: Clean Architecture (camadas detectadas)
‚îú‚îÄ Domain: src/domain/ (models, entities)
‚îú‚îÄ Application: src/application/ (use cases)
‚îú‚îÄ Infrastructure: src/infrastructure/ (repos, DB)
‚îî‚îÄ Presentation: src/api/ (controllers, routes)

Decis√µes T√©cnicas:
- Repository Pattern para acesso a dados
- Dependency Injection via FastAPI
- JWT para autentica√ß√£o
- Pydantic para valida√ß√£o
```

---

### Passo 3: Analisar Hist√≥rico Git (se dispon√≠vel)

```
üìö Analisando hist√≥rico Git...
```

**3.1. Extrair m√©tricas do reposit√≥rio**:

```bash
# Executar:
git log --all --format="%h|%an|%ae|%ad|%s" --date=short > /tmp/git_history.txt

# Processar:
- Total de commits
- Principais contribuidores
- Per√≠odo de desenvolvimento
- Frequ√™ncia de commits
- Features principais (via mensagens de commit)
```

**Output**:
```
üìñ Hist√≥rico do Projeto:

Per√≠odo: Jan 2023 - Out 2025 (22 meses)
Commits: 487 total
Contribuidores:
  - Jo√£o Silva (245 commits)
  - Maria Santos (156 commits)
  - Pedro Costa (86 commits)

Marcos Principais (via git tags):
  - v1.0.0 (Jan 2023): Release inicial
  - v1.5.0 (Jun 2023): Autentica√ß√£o JWT
  - v2.0.0 (Dez 2023): Refatora√ß√£o arquitetura
  - v2.5.0 (Out 2025): Multi-tenancy

Features por Commit Messages:
  - feat: autentica√ß√£o (12 commits)
  - feat: produtos (18 commits)
  - feat: relat√≥rios (8 commits)
  - fix: bugs diversos (67 commits)
  - refactor: arquitetura (15 commits)
```

---

### Passo 4: Gerar PRD Retroativo

```
üìù Gerando PRD retroativo...

Criando docs/PRD.md v[vers√£o]...
```

**4.1. Template do PRD Retroativo**:

```markdown
# Product Requirements Document (Retroativo)

## Metadados
- **Vers√£o do PRD**: [vers√£o detectada]
- **Status**: Retroativo (gerado a partir de c√≥digo existente)
- **Data de Cria√ß√£o do PRD**: [hoje]
- **Data de In√≠cio do Projeto**: [primeiro commit git ou "Desconhecida"]
- **√öltima Atualiza√ß√£o do C√≥digo**: [√∫ltimo commit ou hoje]

---

## 1. Vis√£o Geral

### 1.1. Contexto
[Descri√ß√£o fornecida pelo usu√°rio ou placeholder]

Este documento foi criado RETROATIVAMENTE a partir da an√°lise do c√≥digo-fonte existente.
As informa√ß√µes refletem o ESTADO ATUAL do projeto conforme implementado.

### 1.2. Problema Resolvido
[Inferir do c√≥digo ou usar descri√ß√£o]

### 1.3. Solu√ß√£o Implementada
[Descrever baseado nas funcionalidades detectadas]

Sistema implementado usando [stack] com [X] m√≥dulos principais:
- [M√≥dulo 1]
- [M√≥dulo 2]
- [M√≥dulo 3]

---

## 2. Objetivos (Inferidos)

### 2.1. Objetivos de Neg√≥cio
[Inferir das funcionalidades implementadas]

### 2.2. Objetivos T√©cnicos
- [Stack/framework usado]
- [Padr√µes arquiteturais]
- [Bibliotecas principais]

---

## 3. Funcionalidades Implementadas

### 3.1. [M√≥dulo 1]
- ‚úÖ [Funcionalidade A] - Implementada
  - Endpoint: [m√©todo] [rota]
  - Descri√ß√£o: [inferida do c√≥digo]

- ‚úÖ [Funcionalidade B] - Implementada
  - Endpoint: [m√©todo] [rota]
  - Descri√ß√£o: [inferida do c√≥digo]

### 3.2. [M√≥dulo 2]
- ‚úÖ [Funcionalidade C] - Implementada
- ‚úÖ [Funcionalidade D] - Implementada

---

## 4. Requisitos N√£o-Funcionais (Detectados)

### 4.1. Performance
- [Detectado via c√≥digo: caching, otimiza√ß√µes]

### 4.2. Seguran√ßa
- Autentica√ß√£o: [JWT/Session/OAuth detectado]
- Autoriza√ß√£o: [Roles/Permissions detectado]
- Valida√ß√£o: [Pydantic/outras libs]

### 4.3. Escalabilidade
- [Async/workers detectados]
- [Cache/queue systems]

---

## 5. Arquitetura

### 5.1. Stack Tecnol√≥gica
- **Backend**: [framework e vers√£o]
- **Database**: [detectado de configs]
- **Autentica√ß√£o**: [lib detectada]
- **Valida√ß√£o**: [lib detectada]
- **Testes**: [framework detectado]

### 5.2. Estrutura de Diret√≥rios
```
[√Årvore de diret√≥rios do projeto]
```

### 5.3. Padr√µes Arquiteturais
- [Padr√µes detectados no c√≥digo]
- [Camadas identificadas]

---

## 6. Decis√µes Arquiteturais (ADRs Retroativos)

### ADR 001: Uso de [Framework]
- **Data**: [primeiro commit com framework ou "Desconhecida"]
- **Status**: Implementado
- **Contexto**: [Inferir necessidade]
- **Decis√£o**: Usar [framework]
- **Consequ√™ncias**:
  - ‚úÖ [Benef√≠cio 1]
  - ‚ö†Ô∏è [Trade-off 1]

### ADR 002: [Padr√£o Arquitetural]
- **Data**: [git blame do arquivo relevante]
- **Status**: Implementado
- **Contexto**: [Inferir do c√≥digo]
- **Decis√£o**: Implementar [padr√£o]
- **Consequ√™ncias**: [Impacto detectado]

[Adicionar mais ADRs conforme detectados]

---

## 7. M√©tricas Atuais

### 7.1. C√≥digo
- **Total de Arquivos**: [X]
- **Linhas de C√≥digo**: [X]
- **Complexidade Ciclom√°tica**: [M√©dia]
- **Duplica√ß√£o**: [X]%
- **Cobertura de Testes**: [X]% (se detectado)

### 7.2. Funcionalidades
- **Endpoints/Comandos**: [X]
- **Modelos/Entidades**: [X]
- **M√≥dulos Principais**: [X]

### 7.3. Desenvolvimento
- **Commits Totais**: [X]
- **Contribuidores**: [X]
- **Idade do Projeto**: [X meses]
- **√öltimo Commit**: [X dias atr√°s]

---

## 8. Hist√≥rico de Vers√µes (Git Tags)

| Vers√£o | Data | Descri√ß√£o |
|--------|------|-----------|
| [v1.0.0] | [data] | Release inicial |
| [v1.5.0] | [data] | [Feature principal] |
| [v2.0.0] | [data] | [Breaking change] |
| [v2.5.0] | [data] | Vers√£o atual |

---

## 9. Roadmap Futuro (Placeholder)

**NOTA**: Esta se√ß√£o precisa ser preenchida manualmente com base em requisitos futuros.

### Pr√≥ximas Features
- [ ] [Feature a ser implementada]
- [ ] [Feature a ser implementada]

### Melhorias T√©cnicas
- [ ] [Melhoria sugerida]
- [ ] [D√©bito t√©cnico a pagar]

---

## 10. Observa√ß√µes

### 10.1. Limita√ß√µes deste PRD
- ‚úÖ Funcionalidades: Extra√≠das automaticamente do c√≥digo
- ‚ö†Ô∏è Requisitos de Neg√≥cio: Inferidos (necessitam valida√ß√£o)
- ‚ö†Ô∏è Contexto Hist√≥rico: Limitado ao git history
- ‚ùå Decis√µes Futuras: N√£o documentadas (adicionar manualmente)

### 10.2. Pr√≥ximos Passos
1. Revisar e validar funcionalidades detectadas
2. Adicionar contexto de neg√≥cio real
3. Documentar decis√µes futuras
4. Manter PRD atualizado com novas features

---

**Este PRD foi gerado automaticamente via `/prd-retrofit`**
**√öltima atualiza√ß√£o**: [data de gera√ß√£o]
```

**4.2. Salvar PRD**:

```bash
# Criar diret√≥rio
mkdir -p docs/

# Salvar
# docs/PRD.md
```

---

### Passo 5: Confirma√ß√£o

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ PRD RETROATIVO CRIADO!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Localiza√ß√£o: docs/PRD.md
Vers√£o: [vers√£o]

üìä Conte√∫do Gerado:

An√°lise Autom√°tica:
‚îú‚îÄ [X] funcionalidades detectadas
‚îú‚îÄ [X] decis√µes arquiteturais documentadas
‚îú‚îÄ [X] ADRs retroativos criados
‚îî‚îÄ [X] m√©tricas calculadas

Hist√≥rico Git:
‚îú‚îÄ [X] commits analisados
‚îú‚îÄ [X] vers√µes documentadas
‚îî‚îÄ [X] contribuidores listados

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚ö†Ô∏è  IMPORTANTE: Revisar PRD

Este PRD foi gerado AUTOMATICAMENTE e pode conter:
- Funcionalidades mal interpretadas
- Contexto de neg√≥cio incorreto
- ADRs incompletos

Pr√≥ximos passos:
1. Ler docs/PRD.md
2. Validar funcionalidades detectadas
3. Adicionar contexto de neg√≥cio real
4. Corrigir interpreta√ß√µes incorretas
5. Documentar decis√µes futuras

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Editar PRD agora? (s/n)
```

---

## üìö Exemplos de Uso

### Exemplo 1: Projeto FastAPI sem Documenta√ß√£o

```bash
/prd-retrofit "API de gerenciamento de usu√°rios"
```

**Resultado**:
```
‚úÖ PRD Criado!

Vers√£o detectada: 1.5.0 (via git tag)
Stack: FastAPI + SQLAlchemy + Pydantic

Funcionalidades extra√≠das:
- 15 endpoints REST
- 5 modelos de dados
- Autentica√ß√£o JWT
- Valida√ß√£o Pydantic

ADRs gerados: 4
- ADR 001: Uso de FastAPI
- ADR 002: Repository Pattern
- ADR 003: JWT Authentication
- ADR 004: Clean Architecture

Arquivo: docs/PRD.md (gerado)
```

### Exemplo 2: CLI Tool Python

```bash
/prd-retrofit --version 2.0.0
```

**Resultado**:
```
‚úÖ PRD Criado (v2.0.0)!

Tipo: CLI Tool
Framework: Click

Comandos detectados:
- init: Inicializar projeto
- build: Build do projeto
- deploy: Deploy para produ√ß√£o
- test: Executar testes

Estrutura:
- src/cli/ (comandos)
- src/core/ (l√≥gica)
- tests/ (testes)

Arquivo: docs/PRD.md
```

### Exemplo 3: Projeto Django Legado

```bash
/prd-retrofit
```

**Resultado**:
```
‚úÖ PRD Criado!

Vers√£o: 3.2.0 (de apps/core/__init__.py)
Framework: Django 4.2

Apps detectados:
- users (autentica√ß√£o)
- products (cat√°logo)
- orders (pedidos)
- analytics (relat√≥rios)

Models: 18
Views: 32
Templates: 45

Hist√≥rico Git:
- 1,245 commits
- 5 anos de desenvolvimento
- 8 contribuidores

Arquivo: docs/PRD.md (3,500 linhas geradas)
```

---

## ‚ö†Ô∏è Limita√ß√µes

### An√°lise Autom√°tica √© Heur√≠stica

PRD gerado √© baseado em:
- ‚úÖ C√≥digo fonte (estrutura, imports, fun√ß√µes)
- ‚úÖ Git history (commits, tags, contributors)
- ‚ö†Ô∏è Infer√™ncias (prop√≥sito, contexto de neg√≥cio)
- ‚ùå Requisitos reais de neg√≥cio (n√£o detect√°veis)

**Solu√ß√£o**: Sempre revisar e complementar manualmente.

### Contexto de Neg√≥cio Limitado

C√≥digo n√£o revela:
- Por que decis√µes foram tomadas
- Requisitos de neg√≥cio originais
- Motiva√ß√£o de features
- Roadmap futuro

**Solu√ß√£o**: Adicionar se√ß√µes manualmente no PRD.

### Git History Pode Ser Incompleto

Se projeto tem:
- Poucos commits informativos
- Mensagens gen√©ricas ("fix", "update")
- Hist√≥rico reescrito (rebase)
- Sem tags de vers√£o

**Resultado**: PRD ter√° menos contexto hist√≥rico.

---

## üéØ Quando Usar

### ‚úÖ Use `/prd-retrofit` quando:

1. **Projeto sem PRD**: C√≥digo existe mas nunca foi documentado
2. **Documenta√ß√£o Desatualizada**: PRD antigo n√£o reflete c√≥digo atual
3. **Baseline para Futuro**: Quer documentar estado atual antes de evoluir
4. **Auditoria de C√≥digo**: Precisa entender projeto legado rapidamente

### ‚ùå N√ÉO use `/prd-retrofit` quando:

1. **Projeto Novo**: Use `/setup-project-incremental`
2. **Quer Setup Completo**: Use `/adopt-incremental` (PRD + CLAUDE.md + Roadmap)
3. **PRD Existe e Est√° Correto**: Use `/prd-update` ou `/prd-fix`

---

## üîó Comandos Relacionados

- `/adopt-incremental` - An√°lise completa + PRD + Setup YAGNI
- `/setup-project-incremental` - Para projetos novos
- `/prd-update` - Atualizar PRD existente
- `/prd-view` - Ver PRD atual
- `/prd-help` - Ajuda completa

---

## üí° Dicas

### Revisar Funcionalidades Detectadas

```bash
# Ap√≥s gerar PRD
grep "‚úÖ" docs/PRD.md

# Validar:
- Todas as funcionalidades foram detectadas?
- Alguma foi mal interpretada?
- Falta algo importante?
```

### Adicionar Contexto de Neg√≥cio

```markdown
# Editar docs/PRD.md

## 1. Vis√£o Geral

### 1.1. Contexto
[Substituir placeholder gerado por contexto real]

Problema REAL que o projeto resolve:
- [Adicionar manualmente]
```

### Documentar Decis√µes Futuras

```markdown
## 9. Roadmap Futuro

### Pr√≥ximas Features (Manual)
- [ ] Implementar multi-tenancy
- [ ] Adicionar relat√≥rios avan√ßados
- [ ] Integrar com sistema X

Raz√£o: [Explicar por qu√™]
Prioridade: [Alta/M√©dia/Baixa]
```

### Manter PRD Atualizado

```bash
# Ap√≥s adicionar nova feature
/prd-update "Adicionei feature X"

# Ou editar manualmente
vim docs/PRD.md
```

---

**Desenvolvido para incremental-dev - PRD Retroativo Autom√°tico** üìÑ
