# 04 - Componentes do Plugin

## üìã Vis√£o Geral

Este documento detalha todos os componentes que podem fazer parte de um plugin do Claude Code: Commands, Agents, Hooks, MCP Servers e Skills.

---

## üß© Tipos de Componentes

Um plugin do Claude Code pode incluir:

1. **Commands** - Comandos personalizados (slash commands)
2. **Agents** - Agentes especializados para tarefas espec√≠ficas
3. **Hooks** - Ganchos de ciclo de vida
4. **MCP Servers** - Servidores do Model Context Protocol
5. **Skills** - Habilidades para agentes

---

## üí¨ 1. Commands (Comandos)

### O que s√£o?

Comandos s√£o arquivos Markdown que aparecem como **slash commands** (`/comando`) no Claude Code.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ commands/
    ‚îú‚îÄ‚îÄ comando1.md
    ‚îú‚îÄ‚îÄ comando2.md
    ‚îî‚îÄ‚îÄ comando3.md
```

### Estrutura de um Comando

```markdown
---
description: Descri√ß√£o curta do comando (obrigat√≥rio)
---

Conte√∫do do comando em Markdown.

Este texto ser√° processado como um prompt pelo Claude Code quando o usu√°rio executar o comando.
```

### Exemplo B√°sico

**Arquivo**: `commands/hello.md`

```markdown
---
description: Exibe uma mensagem de boas-vindas
---

Ol√°! üëã

Bem-vindo ao Claude Code!

Este √© um comando personalizado que voc√™ pode usar a qualquer momento.
```

**Uso**: `/hello`

### Exemplo com Vari√°veis

**Arquivo**: `commands/greet.md`

```markdown
---
description: Cumprimenta uma pessoa espec√≠fica
---

Ol√° {{name}}! üëã

√â um prazer te conhecer. Como posso ajudar voc√™ hoje?
```

**Uso**: `/greet name="Jo√£o"`

### Exemplo Avan√ßado

**Arquivo**: `commands/create-component.md`

```markdown
---
description: Cria um novo componente React
---

# Criar Novo Componente React

Vou criar um componente React para voc√™.

## Informa√ß√µes necess√°rias:

- Nome do componente: {{componentName}}
- Tipo: {{type}} (functional/class)
- Com TypeScript: {{typescript}} (yes/no)

## Arquivo que ser√° criado:

```typescript
// src/components/{{componentName}}/{{componentName}}.tsx

import React from 'react';

interface {{componentName}}Props {
  // Props aqui
}

export const {{componentName}}: React.FC<{{componentName}}Props> = (props) => {
  return (
    <div>
      <h1>{{componentName}}</h1>
    </div>
  );
};
```

Deseja que eu crie este arquivo?
```

**Uso**:
```bash
/create-component componentName="Button" type="functional" typescript="yes"
```

### Vari√°veis Dispon√≠veis

Voc√™ pode usar vari√°veis de ambiente e vari√°veis especiais:

| Vari√°vel | Descri√ß√£o | Exemplo |
|----------|-----------|---------|
| `{{name}}` | Par√¢metros customizados | `/cmd name="Jo√£o"` |
| `{{date}}` | Data atual | `2025-01-15` |
| `{{time}}` | Hora atual | `14:30:00` |
| `${USER}` | Vari√°vel de ambiente | Nome do usu√°rio do sistema |
| `${PWD}` | Diret√≥rio atual | `/home/user/project` |

---

## ü§ñ 2. Agents (Agentes)

### O que s√£o?

Agentes s√£o **sub-agentes especializados** que podem ser invocados para executar tarefas espec√≠ficas de forma aut√¥noma.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ agents/
    ‚îú‚îÄ‚îÄ test-runner.md
    ‚îú‚îÄ‚îÄ code-reviewer.md
    ‚îî‚îÄ‚îÄ api-tester.md
```

### Estrutura de um Agente

```markdown
---
description: Descri√ß√£o do agente (obrigat√≥rio)
---

# Nome do Agente

Descri√ß√£o detalhada do que o agente faz.

## Responsabilidades:

1. Tarefa 1
2. Tarefa 2
3. Tarefa 3

## Como usar:

Instru√ß√µes de uso.
```

### Exemplo: Test Runner Agent

**Arquivo**: `agents/test-runner.md`

```markdown
---
description: Executa testes automatizados do projeto
---

# Test Runner Agent

Sou um agente especializado em executar e analisar testes.

## Minhas Responsabilidades:

1. **Detectar framework de testes**
   - Jest, Mocha, PyTest, JUnit, etc.

2. **Executar testes**
   - Testes unit√°rios
   - Testes de integra√ß√£o
   - Testes E2E

3. **Analisar resultados**
   - Identificar testes falhando
   - Calcular cobertura
   - Gerar relat√≥rios

4. **Sugerir corre√ß√µes**
   - Analisar falhas
   - Propor solu√ß√µes

## Como me usar:

Simplesmente pe√ßa para executar os testes e eu:

1. Identificarei o framework usado
2. Executarei os testes apropriados
3. Analisarei os resultados
4. Reportarei os achados
5. Sugerirei corre√ß√µes se necess√°rio

## Exemplos:

- "Execute os testes unit√°rios"
- "Rode todos os testes e me mostre a cobertura"
- "Teste apenas o m√≥dulo de autentica√ß√£o"
```

### Exemplo: Code Reviewer Agent

**Arquivo**: `agents/code-reviewer.md`

```markdown
---
description: Revisa c√≥digo seguindo as melhores pr√°ticas
---

# Code Reviewer Agent

Sou um agente especializado em revisar c√≥digo.

## Crit√©rios de Revis√£o:

### 1. Qualidade do C√≥digo
- Legibilidade
- Manutenibilidade
- Complexidade
- Duplica√ß√£o

### 2. Boas Pr√°ticas
- Padr√µes de projeto
- SOLID principles
- Clean Code

### 3. Performance
- Complexidade algor√≠tmica
- Uso de mem√≥ria
- Otimiza√ß√µes poss√≠veis

### 4. Seguran√ßa
- Vulnerabilidades
- Input validation
- Exposi√ß√£o de dados sens√≠veis

### 5. Testes
- Cobertura de testes
- Qualidade dos testes
- Edge cases

## Processo de Revis√£o:

1. Analisar o c√≥digo alterado
2. Identificar problemas
3. Sugerir melhorias
4. Explicar o racioc√≠nio
5. Fornecer exemplos de corre√ß√£o

## Como me usar:

Ap√≥s fazer altera√ß√µes no c√≥digo, pe√ßa para revisar e eu farei uma an√°lise completa.
```

### Exemplo: API Tester Agent

**Arquivo**: `agents/api-tester.md`

```markdown
---
description: Testa APIs REST e GraphQL
---

# API Tester Agent

Especialista em testar APIs REST e GraphQL.

## Capacidades:

### REST APIs
- GET, POST, PUT, DELETE, PATCH
- Autentica√ß√£o (Bearer, Basic, API Key)
- Headers customizados
- Valida√ß√£o de resposta

### GraphQL
- Queries
- Mutations
- Subscriptions
- Schema validation

## Processo de Teste:

1. **Configura√ß√£o**
   - Endpoint
   - Autentica√ß√£o
   - Headers

2. **Execu√ß√£o**
   - Fazer requisi√ß√µes
   - Medir tempo de resposta
   - Capturar erros

3. **Valida√ß√£o**
   - Status code
   - Response body
   - Response headers
   - Schema validation

4. **Relat√≥rio**
   - Resultados
   - M√©tricas
   - Problemas encontrados

## Exemplo de Uso:

```
Teste a API em https://api.example.com/users
com autentica√ß√£o Bearer e valide:
- Status 200
- Array de usu√°rios
- Cada usu√°rio tem id, name, email
```
```

---

## ü™ù 3. Hooks (Ganchos)

### O que s√£o?

Hooks permitem executar **a√ß√µes autom√°ticas** em momentos espec√≠ficos do ciclo de vida do Claude Code.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ hooks/
    ‚îî‚îÄ‚îÄ hooks.json
```

### Tipos de Hooks (8 no total)

| Hook | Quando Dispara | Uso Comum |
|------|---------------|-----------|
| `user-prompt-submit` | Usu√°rio envia prompt | Valida√ß√£o, logging, modifica√ß√£o |
| `tool-call-before` | Antes de chamar ferramenta | Valida√ß√£o, logging |
| `tool-call-after` | Depois de chamar ferramenta | An√°lise, modifica√ß√£o de resultado |
| `file-edit-before` | Antes de editar arquivo | Backup, valida√ß√£o |
| `file-edit-after` | Depois de editar arquivo | Formata√ß√£o, linting |
| `session-start` | In√≠cio da sess√£o | Configura√ß√£o, logging |
| `session-end` | Fim da sess√£o | Cleanup, relat√≥rios |
| `error` | Quando ocorre erro | Logging, notifica√ß√£o |

### Estrutura do hooks.json

```json
{
  "hooks": [
    {
      "type": "nome-do-hook",
      "command": "comando-a-executar",
      "args": ["arg1", "arg2"],
      "env": {
        "VAR": "valor"
      }
    }
  ]
}
```

### Exemplo: Hook de Valida√ß√£o

**Arquivo**: `hooks/hooks.json`

```json
{
  "hooks": [
    {
      "type": "user-prompt-submit",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/validate-prompt.js"],
      "description": "Valida o prompt do usu√°rio antes de processar"
    }
  ]
}
```

### Exemplo: Hook de Formata√ß√£o Autom√°tica

```json
{
  "hooks": [
    {
      "type": "file-edit-after",
      "command": "prettier",
      "args": ["--write", "${FILE_PATH}"],
      "description": "Formata arquivo automaticamente ap√≥s edi√ß√£o"
    },
    {
      "type": "file-edit-after",
      "command": "eslint",
      "args": ["--fix", "${FILE_PATH}"],
      "description": "Executa ESLint ap√≥s edi√ß√£o"
    }
  ]
}
```

### Exemplo: Hook de Testes Autom√°ticos

```json
{
  "hooks": [
    {
      "type": "file-edit-after",
      "command": "npm",
      "args": ["test", "--", "--testPathPattern=${FILE_PATH}"],
      "description": "Executa testes relacionados ao arquivo editado"
    }
  ]
}
```

### Exemplo Completo com M√∫ltiplos Hooks

```json
{
  "hooks": [
    {
      "type": "session-start",
      "command": "echo",
      "args": ["üöÄ Sess√£o iniciada em $(date)"],
      "description": "Log de in√≠cio de sess√£o"
    },
    {
      "type": "user-prompt-submit",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/log-prompt.js"],
      "env": {
        "LOG_FILE": "${HOME}/.claude/prompts.log"
      },
      "description": "Registra todos os prompts"
    },
    {
      "type": "file-edit-after",
      "command": "prettier",
      "args": ["--write", "${FILE_PATH}"],
      "description": "Formata c√≥digo"
    },
    {
      "type": "file-edit-after",
      "command": "git",
      "args": ["add", "${FILE_PATH}"],
      "description": "Adiciona ao stage automaticamente"
    },
    {
      "type": "error",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/log-error.js"],
      "description": "Registra erros"
    },
    {
      "type": "session-end",
      "command": "echo",
      "args": ["‚úÖ Sess√£o finalizada"],
      "description": "Log de fim de sess√£o"
    }
  ]
}
```

### Vari√°veis Dispon√≠veis em Hooks

| Vari√°vel | Dispon√≠vel em | Descri√ß√£o |
|----------|--------------|-----------|
| `${CLAUDE_PLUGIN_ROOT}` | Todos | Raiz do plugin |
| `${FILE_PATH}` | `file-edit-*` | Caminho do arquivo |
| `${TOOL_NAME}` | `tool-call-*` | Nome da ferramenta |
| `${PROMPT}` | `user-prompt-submit` | Prompt do usu√°rio |
| `${ERROR_MESSAGE}` | `error` | Mensagem de erro |

---

## üîó 4. MCP Servers (Model Context Protocol)

### O que s√£o?

MCP Servers conectam **ferramentas e servi√ßos externos** ao Claude Code.

### Configura√ß√£o

Dois formatos poss√≠veis:

#### 4.1. Arquivo .mcp.json (Standalone)

**Localiza√ß√£o**:
```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ .mcp.json
```

**Exemplo**:
```json
{
  "database-tools": {
    "command": "node",
    "args": ["${CLAUDE_PLUGIN_ROOT}/servers/db-server.js"],
    "env": {
      "DATABASE_URL": "${DATABASE_URL}"
    }
  },
  "api-client": {
    "command": "${CLAUDE_PLUGIN_ROOT}/servers/api-mcp",
    "args": ["--verbose"],
    "env": {
      "API_KEY": "${MY_API_KEY}"
    }
  }
}
```

#### 4.2. Inline no plugin.json

**Exemplo**:
```json
{
  "name": "meu-plugin",
  "version": "1.0.0",
  "description": "Plugin com MCP",
  "mcpServers": {
    "database": {
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/servers/db.js"],
      "env": {
        "DB_URL": "${DATABASE_URL}"
      }
    }
  }
}
```

### Exemplo: MCP Server para Banco de Dados

**.mcp.json**:
```json
{
  "postgres": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-postgres"],
    "env": {
      "POSTGRES_URL": "${DATABASE_URL}"
    }
  }
}
```

### Exemplo: MCP Server Personalizado

**Estrutura**:
```
plugins/api-plugin/
‚îú‚îÄ‚îÄ .mcp.json
‚îî‚îÄ‚îÄ servers/
    ‚îî‚îÄ‚îÄ api-mcp/
        ‚îú‚îÄ‚îÄ index.js
        ‚îî‚îÄ‚îÄ package.json
```

**.mcp.json**:
```json
{
  "custom-api": {
    "command": "node",
    "args": ["${CLAUDE_PLUGIN_ROOT}/servers/api-mcp/index.js"],
    "env": {
      "API_BASE_URL": "https://api.example.com",
      "API_KEY": "${MY_API_KEY}"
    }
  }
}
```

**servers/api-mcp/index.js** (simplificado):
```javascript
#!/usr/bin/env node

const MCP = require('@modelcontextprotocol/sdk');

const server = new MCP.Server({
  name: 'custom-api',
  version: '1.0.0'
});

// Registrar ferramenta
server.tool('fetch-data', async (params) => {
  const response = await fetch(
    `${process.env.API_BASE_URL}/data`,
    {
      headers: {
        'Authorization': `Bearer ${process.env.API_KEY}`
      }
    }
  );
  return await response.json();
});

server.start();
```

---

## üéØ 5. Skills (Habilidades para Agentes)

### O que s√£o?

Skills s√£o **capacidades reutiliz√°veis** que podem ser usadas por agentes.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ database-skill/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md
    ‚îî‚îÄ‚îÄ api-skill/
        ‚îî‚îÄ‚îÄ SKILL.md
```

### Estrutura de uma Skill

```markdown
---
description: Descri√ß√£o da skill
---

# Nome da Skill

Descri√ß√£o do que a skill faz e como usar.

## Capacidades:

- Capacidade 1
- Capacidade 2

## Exemplos de Uso:

[Exemplos]
```

### Exemplo: Database Skill

**Arquivo**: `skills/database-skill/SKILL.md`

```markdown
---
description: Skill para interagir com bancos de dados
---

# Database Skill

Fornece capacidades para interagir com diferentes bancos de dados.

## Suporta:

- PostgreSQL
- MySQL
- SQLite
- MongoDB

## Capacidades:

### 1. Executar Queries
```sql
SELECT * FROM users WHERE active = true;
```

### 2. Criar Tabelas
```sql
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  price DECIMAL(10,2)
);
```

### 3. Migrations
- Criar migrations
- Executar migrations
- Rollback migrations

### 4. An√°lise
- Explicar query plans
- Sugerir √≠ndices
- Otimizar queries

## Uso em Agentes:

Agentes podem usar esta skill para:
- Consultar dados
- Modificar esquemas
- Analisar performance
- Gerar relat√≥rios
```

### Exemplo: API Skill

**Arquivo**: `skills/api-skill/SKILL.md`

```markdown
---
description: Skill para trabalhar com APIs REST
---

# API Skill

Capacidades para interagir com APIs REST.

## Capacidades:

### 1. HTTP Methods
- GET - Buscar dados
- POST - Criar recursos
- PUT/PATCH - Atualizar recursos
- DELETE - Remover recursos

### 2. Autentica√ß√£o
- Bearer Token
- API Key
- Basic Auth
- OAuth 2.0

### 3. Formatos
- JSON
- XML
- Form Data
- Multipart

### 4. Valida√ß√£o
- Schema validation
- Status codes
- Response headers
- Error handling

## Exemplo de Uso:

```javascript
// GET request
const users = await api.get('/users', {
  headers: {
    'Authorization': 'Bearer ${API_TOKEN}'
  }
});

// POST request
const newUser = await api.post('/users', {
  body: {
    name: 'Jo√£o',
    email: 'joao@example.com'
  }
});
```

## Integra√ß√£o com Agentes:

Agentes podem usar esta skill para:
- Testar endpoints
- Documentar APIs
- Gerar clientes
- Validar contratos
```

---

## üìè Tamanhos Recomendados e Separa√ß√£o de Responsabilidades

### A Regra de Ouro

```
Agent = COMO fazer (processo de execu√ß√£o, 50-200 linhas)
Command = Interface (invoca agents/MCPs, 20-100 linhas)
Skill = O QUE saber (conhecimento de dom√≠nio, <500 linhas)
```

### Tabela de Tamanhos

| Componente | Tamanho Ideal | Tamanho M√°ximo | A√ß√£o se Excedido |
|------------|--------------|----------------|------------------|
| **Agent** | 50-150 linhas | 200 linhas | Extrair conhecimento para skills OU dividir em m√∫ltiplos agents |
| **Command** | 20-50 linhas | 100 linhas | Extrair l√≥gica para agent se cont√©m l√≥gica de neg√≥cio |
| **Skill (SKILL.md)** | 200-300 linhas | 500 linhas | Usar progressive disclosure (arquivos de refer√™ncia) |
| **Setup addition to CLAUDE.md** | 20-30 linhas | 40 linhas | Usar progressive disclosure, link para README.md |

### Diferen√ßas Cr√≠ticas de Estrutura

#### Agents (Sub-agentes)

**‚ùå INCORRETO** - Agents N√ÉO s√£o pastas:
```
.claude/agents/my-agent/
‚îú‚îÄ‚îÄ my-agent.md
‚îî‚îÄ‚îÄ reference.md        # ‚ùå N√ÉO SUPORTADO
```

**‚úÖ CORRETO** - Agents s√£o arquivos .md √öNICOS:
```
.claude/agents/my-agent.md  # ‚Üê TODO o conte√∫do em UM arquivo
```

**Por qu√™?**
- Agents operam em contexto isolado
- Precisam de system prompt completo em arquivo √∫nico
- **N√ÉO suportam progressive disclosure**
- Devem incluir TODAS as instru√ß√µes em um .md

#### Skills

**‚úÖ CORRETO** - Skills PODEM ter m√∫ltiplos arquivos:
```
.claude/skills/my-skill/
‚îú‚îÄ‚îÄ SKILL.md           # Vis√£o geral (< 500 linhas)
‚îú‚îÄ‚îÄ reference.md       # Documenta√ß√£o de suporte
‚îî‚îÄ‚îÄ patterns.md        # Biblioteca de padr√µes
```

**Por qu√™?**
- Usam padr√£o de progressive disclosure
- Carregam arquivos adicionais on-demand via Read tool
- Podem organizar conhecimento em m√∫ltiplos arquivos
- SKILL.md serve como overview/√≠ndice

### Quando Extrair Conhecimento para Skills

**Extrair para skill se**:

1. **Agent > 200 linhas**
2. **Se√ß√µes de documenta√ß√£o ou refer√™ncia**
3. **M√∫ltiplas tabelas de refer√™ncia**
4. **Padr√µes de c√≥digo ou templates**
5. **Conhecimento duplicado entre agents**

### Exemplo de Refatora√ß√£o

#### Antes (Agent com 310 linhas)

```markdown
# test-generator.md (310 linhas)

## Instructions
[80 linhas de processo]

## Mock Patterns for LangChain    # ‚Üê Conhecimento - EXTRAIR!
[150 linhas de patterns]

## Pytest Best Practices    # ‚Üê Conhecimento - EXTRAIR!
[80 linhas de docs]
```

**Problemas**:
- ‚ùå Agent muito grande (310 linhas)
- ‚ùå Mistura processo com conhecimento
- ‚ùå Conhecimento n√£o reutiliz√°vel
- ‚ùå Dif√≠cil manuten√ß√£o

#### Depois (Agent 90 linhas + Skills)

**Agent focado no processo**:
```markdown
# test-generator.md (90 linhas)

## Instructions
For LangChain mock patterns, see skill `langchain-mock-patterns`
For pytest best practices, see skill `pytest-best-practices`

[80 linhas de processo essencial]
```

**Skills reutiliz√°veis**:
```
plugins/python-test-generator/
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îî‚îÄ‚îÄ test-generator.md         # 90 linhas
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ langchain-mock-patterns/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md               # 150 linhas
    ‚îî‚îÄ‚îÄ pytest-best-practices/
        ‚îî‚îÄ‚îÄ SKILL.md               # 80 linhas
```

**Benef√≠cios**:
- ‚úÖ Agent focado (90 linhas)
- ‚úÖ Skills reutiliz√°veis por outros agents
- ‚úÖ Manuten√ß√£o mais f√°cil
- ‚úÖ Conhecimento organizado por dom√≠nio
- ‚úÖ Performance otimizada

### O Fluxo Correto

#### 1. Agents Executam Tarefas (COMO fazer)

- Processo de execu√ß√£o passo-a-passo
- L√≥gica de orquestra√ß√£o
- Invoca√ß√£o de tools
- **Arquivo .md √∫nico** (sem progressive disclosure)
- **50-200 linhas ideal**

**Exemplo**:
```markdown
# commit-assistant.md (150 linhas)

For conventional commit rules, see skill `conventional-commits`
For CI detection, see skill `ci-detection`

## Process:
1. Validate security
2. Run CI/CD (see skill for tool detection)
3. Analyze changes
4. Generate commit message (see skill for format)
5. Commit and push
```

#### 2. Commands Facilitam Invoca√ß√£o (Interface)

- Interface voltada para o usu√°rio
- Invoca agents via Task tool
- Invoca MCPs
- **SEM l√≥gica de neg√≥cio** (delega para agents)
- **20-100 linhas**

**Exemplo**:
```markdown
# commit.md (19 linhas)

Use agent commit-assistant to execute full commit process
```

#### 3. Skills Fornecem Conhecimento (O QUE saber)

- Conhecimento de dom√≠nio
- Documenta√ß√£o de API
- Melhores pr√°ticas
- Padr√µes de c√≥digo
- **Auto-descobertas por Claude**
- **Progressive disclosure suportado** (estrutura de pasta)
- **SKILL.md < 500 linhas**

**Exemplo**:
```
skills/
‚îú‚îÄ‚îÄ conventional-commits/        # Pasta com m√∫ltiplos arquivos
‚îÇ   ‚îú‚îÄ‚îÄ SKILL.md                 # Conhecimento
‚îÇ   ‚îî‚îÄ‚îÄ examples.md
‚îî‚îÄ‚îÄ ci-detection/
    ‚îî‚îÄ‚îÄ SKILL.md
```

### Sinais de Alerta

**üö® Agent Precisa Refatora√ß√£o**:

- ‚úÖ Agent > 200 linhas
- ‚úÖ Se√ß√µes com "Documentation" ou "Reference"
- ‚úÖ M√∫ltiplas tabelas de refer√™ncia
- ‚úÖ Conhecimento duplicado entre agents
- ‚úÖ Agent faz "tudo"

**A√ß√£o**: Identificar se√ß√µes de conhecimento ‚Üí Extrair para skills ‚Üí Agent reduzido para ~150 linhas

**üö® Command com L√≥gica de Neg√≥cio**:

- ‚úÖ Command > 100 linhas
- ‚úÖ Cont√©m passos de processo
- ‚úÖ Cont√©m l√≥gica de decis√£o complexa

**A√ß√£o**: Criar agent com processo ‚Üí Command apenas invoca agent (~50 linhas)

### Processo de Refatora√ß√£o

#### Para Agent > 200 linhas:

1. **Identificar se√ß√µes**:
   - Processo/execu√ß√£o ‚Üí manter no agent
   - Conhecimento/docs ‚Üí extrair para skill

2. **Para cada se√ß√£o de conhecimento**:
   - \> 50 linhas? ‚Üí extrair para skill
   - Usado por outro agent? ‚Üí extrair para skill
   - < 50 linhas & espec√≠fico? ‚Üí pode manter

3. **Criar skills separadas** (com estrutura de pasta)

4. **Agent referencia skills**: "See skill X for Y"

5. **Validar**: agent agora < 200 linhas?

#### Para Command com L√≥gica:

1. **Identificar passos independentes do workflow**

2. **Criar agent** (~150 linhas) com processo

3. **Command invoca agent** (~50 linhas)

4. **Validar**: command < 100 linhas?

### Exemplo Completo: Antes & Depois

#### Antes: Command Monol√≠tico (906 linhas)

```markdown
# setup-project-incremental.md (906 linhas)

## Processo de Execu√ß√£o
### 1. Detectar Tipo de Projeto (Novo vs Legacy)
[L√≥gica detalhada de detec√ß√£o - 200 linhas]

### 2. Configurar CLAUDE.md
[L√≥gica de configura√ß√£o - 300 linhas]

### 3. Criar PRD
[L√≥gica de cria√ß√£o - 400 linhas]
```

**Problemas**:
- ‚ùå Command com l√≥gica de neg√≥cio (906 linhas!)
- ‚ùå Deveria ser agent
- ‚ùå Viola padr√£o de separa√ß√£o

#### Depois: Command + Agent (50 + 150 linhas)

**Command** (50 linhas):
```markdown
# setup-project-incremental.md (50 linhas)

Use agent setup-assistant to configure project with YAGNI principles

[Documenta√ß√£o de uso]
```

**Agent** (150 linhas):
```markdown
# setup-assistant.md (150 linhas)

## Process:
1. Detect project type
2. Configure CLAUDE.md (‚â§40 lines)
3. Create PRD v0.1
4. Validate setup
```

**Benef√≠cios**:
- ‚úÖ Command leve (50 linhas)
- ‚úÖ Agent focado em processo (150 linhas)
- ‚úÖ Separa√ß√£o clara de responsabilidades
- ‚úÖ Reutiliz√°vel

### Regras Finais

1. **Agent = COMO, Skill = O QUE**
   - Processo ‚Üí Agent
   - Conhecimento ‚Üí Skill

2. **1 Agent = 1 Responsabilidade**
   - M√∫ltiplas responsabilidades ‚Üí quebrar

3. **Agent > 200 linhas? Revisar!**
   - Identificar conhecimento extra√≠vel
   - Ou quebrar em sub-agents

4. **Teste do Copy-Paste**
   - Se copiaria entre agents ‚Üí extrair para skill

5. **Progressive Disclosure (APENAS SKILLS!)**
   - ‚úÖ Skill > 500 lines ‚Üí arquivos de refer√™ncia
   - ‚ùå Agent > 200 lines ‚Üí N√ÉO suporta progressive disclosure
   - ‚Üí Extrair para skills OU dividir agents

6. **Agents s√£o ARQUIVOS √öNICOS**
   - ‚úÖ `agents/my-agent.md`
   - ‚ùå `agents/my-agent/my-agent.md`

7. **Skills s√£o PASTAS**
   - ‚úÖ `skills/my-skill/SKILL.md`
   - ‚ùå `skills/my-skill.md` (sem progressive disclosure)

8. **Reuso > Especificidade**
   - Conhecimento reutiliz√°vel ‚Üí sempre skill
   - Processo √∫nico ‚Üí pode ficar no agent

---

## üé® Combinando Componentes

### Exemplo: Plugin Completo de Testes

**Estrutura**:
```
plugins/test-suite/
‚îú‚îÄ‚îÄ .claude-plugin/
‚îÇ   ‚îî‚îÄ‚îÄ plugin.json
‚îú‚îÄ‚îÄ .mcp.json
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ test.md
‚îÇ   ‚îú‚îÄ‚îÄ coverage.md
‚îÇ   ‚îî‚îÄ‚îÄ watch.md
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ test-runner.md
‚îÇ   ‚îî‚îÄ‚îÄ test-generator.md
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ hooks.json
‚îî‚îÄ‚îÄ skills/
    ‚îî‚îÄ‚îÄ testing-skill/
        ‚îî‚îÄ‚îÄ SKILL.md
```

**Fluxo de Uso**:
1. Usu√°rio executa `/test`
2. Comando invoca o **test-runner agent**
3. Agent usa a **testing-skill** para detectar framework
4. Agent usa **MCP server** para executar testes
5. **Hook** `file-edit-after` roda testes automaticamente ap√≥s edi√ß√µes

---

## ‚úÖ Checklist de Componentes

Ao criar um plugin, considere incluir:

### Essencial
- [ ] Pelo menos 1 comando √∫til
- [ ] README.md documentando uso

### Recomendado
- [ ] Agente especializado para tarefa principal
- [ ] Hooks para automa√ß√£o
- [ ] Skills reutiliz√°veis

### Avan√ßado
- [ ] MCP server para integra√ß√µes externas
- [ ] M√∫ltiplos agentes para tarefas complexas
- [ ] Suite completa de hooks

---

## üöÄ Pr√≥ximos Passos

Agora que voc√™ conhece todos os componentes, aprenda a:

‚û°Ô∏è [05 - Publica√ß√£o e Distribui√ß√£o](./05-publicacao-e-distribuicao.md)

---

[‚¨ÖÔ∏è Anterior: Criando um Plugin](./03-criando-plugin.md) | [‚¨ÖÔ∏è Voltar ao √çndice](./README.md) | [‚û°Ô∏è Pr√≥ximo: Publica√ß√£o e Distribui√ß√£o](./05-publicacao-e-distribuicao.md)
