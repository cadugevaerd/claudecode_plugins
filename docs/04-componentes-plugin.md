# 04 - Componentes do Plugin

## üìã Vis√£o Geral

Este documento detalha todos os componentes que podem fazer parte de um plugin do Claude Code: Commands, Agents, Hooks, MCP Servers e Skills.

---

## üß© Tipos de Componentes

Um plugin do Claude Code pode incluir:

1. **Commands** - Comandos personalizados (slash commands)
2. **Agents** - Agentes especializados para tarefas espec√≠ficas
3. **Hooks** - Ganchos de ciclo de vida
4. **MCP Servers** - Servidores do Model Context Protocol
5. **Skills** - Habilidades para agentes

---

## üí¨ 1. Commands (Comandos)

### O que s√£o?

Comandos s√£o arquivos Markdown que aparecem como **slash commands** (`/comando`) no Claude Code.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ commands/
    ‚îú‚îÄ‚îÄ comando1.md
    ‚îú‚îÄ‚îÄ comando2.md
    ‚îî‚îÄ‚îÄ comando3.md
```

### Estrutura de um Comando

```markdown
---
description: Descri√ß√£o curta do comando (obrigat√≥rio)
---

Conte√∫do do comando em Markdown.

Este texto ser√° processado como um prompt pelo Claude Code quando o usu√°rio executar o comando.
```

### Exemplo B√°sico

**Arquivo**: `commands/hello.md`

```markdown
---
description: Exibe uma mensagem de boas-vindas
---

Ol√°! üëã

Bem-vindo ao Claude Code!

Este √© um comando personalizado que voc√™ pode usar a qualquer momento.
```

**Uso**: `/hello`

### Exemplo com Vari√°veis

**Arquivo**: `commands/greet.md`

```markdown
---
description: Cumprimenta uma pessoa espec√≠fica
---

Ol√° {{name}}! üëã

√â um prazer te conhecer. Como posso ajudar voc√™ hoje?
```

**Uso**: `/greet name="Jo√£o"`

### Exemplo Avan√ßado

**Arquivo**: `commands/create-component.md`

```markdown
---
description: Cria um novo componente React
---

# Criar Novo Componente React

Vou criar um componente React para voc√™.

## Informa√ß√µes necess√°rias:

- Nome do componente: {{componentName}}
- Tipo: {{type}} (functional/class)
- Com TypeScript: {{typescript}} (yes/no)

## Arquivo que ser√° criado:

```typescript
// src/components/{{componentName}}/{{componentName}}.tsx

import React from 'react';

interface {{componentName}}Props {
  // Props aqui
}

export const {{componentName}}: React.FC<{{componentName}}Props> = (props) => {
  return (
    <div>
      <h1>{{componentName}}</h1>
    </div>
  );
};
```

Deseja que eu crie este arquivo?
```

**Uso**:
```bash
/create-component componentName="Button" type="functional" typescript="yes"
```

### Vari√°veis Dispon√≠veis

Voc√™ pode usar vari√°veis de ambiente e vari√°veis especiais:

| Vari√°vel | Descri√ß√£o | Exemplo |
|----------|-----------|---------|
| `{{name}}` | Par√¢metros customizados | `/cmd name="Jo√£o"` |
| `{{date}}` | Data atual | `2025-01-15` |
| `{{time}}` | Hora atual | `14:30:00` |
| `${USER}` | Vari√°vel de ambiente | Nome do usu√°rio do sistema |
| `${PWD}` | Diret√≥rio atual | `/home/user/project` |

---

## ü§ñ 2. Agents (Agentes)

### O que s√£o?

Agentes s√£o **sub-agentes especializados** que podem ser invocados para executar tarefas espec√≠ficas de forma aut√¥noma.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ agents/
    ‚îú‚îÄ‚îÄ test-runner.md
    ‚îú‚îÄ‚îÄ code-reviewer.md
    ‚îî‚îÄ‚îÄ api-tester.md
```

### Estrutura de um Agente

```markdown
---
description: Descri√ß√£o do agente (obrigat√≥rio)
---

# Nome do Agente

Descri√ß√£o detalhada do que o agente faz.

## Responsabilidades:

1. Tarefa 1
2. Tarefa 2
3. Tarefa 3

## Como usar:

Instru√ß√µes de uso.
```

### Exemplo: Test Runner Agent

**Arquivo**: `agents/test-runner.md`

```markdown
---
description: Executa testes automatizados do projeto
---

# Test Runner Agent

Sou um agente especializado em executar e analisar testes.

## Minhas Responsabilidades:

1. **Detectar framework de testes**
   - Jest, Mocha, PyTest, JUnit, etc.

2. **Executar testes**
   - Testes unit√°rios
   - Testes de integra√ß√£o
   - Testes E2E

3. **Analisar resultados**
   - Identificar testes falhando
   - Calcular cobertura
   - Gerar relat√≥rios

4. **Sugerir corre√ß√µes**
   - Analisar falhas
   - Propor solu√ß√µes

## Como me usar:

Simplesmente pe√ßa para executar os testes e eu:

1. Identificarei o framework usado
2. Executarei os testes apropriados
3. Analisarei os resultados
4. Reportarei os achados
5. Sugerirei corre√ß√µes se necess√°rio

## Exemplos:

- "Execute os testes unit√°rios"
- "Rode todos os testes e me mostre a cobertura"
- "Teste apenas o m√≥dulo de autentica√ß√£o"
```

### Exemplo: Code Reviewer Agent

**Arquivo**: `agents/code-reviewer.md`

```markdown
---
description: Revisa c√≥digo seguindo as melhores pr√°ticas
---

# Code Reviewer Agent

Sou um agente especializado em revisar c√≥digo.

## Crit√©rios de Revis√£o:

### 1. Qualidade do C√≥digo
- Legibilidade
- Manutenibilidade
- Complexidade
- Duplica√ß√£o

### 2. Boas Pr√°ticas
- Padr√µes de projeto
- SOLID principles
- Clean Code

### 3. Performance
- Complexidade algor√≠tmica
- Uso de mem√≥ria
- Otimiza√ß√µes poss√≠veis

### 4. Seguran√ßa
- Vulnerabilidades
- Input validation
- Exposi√ß√£o de dados sens√≠veis

### 5. Testes
- Cobertura de testes
- Qualidade dos testes
- Edge cases

## Processo de Revis√£o:

1. Analisar o c√≥digo alterado
2. Identificar problemas
3. Sugerir melhorias
4. Explicar o racioc√≠nio
5. Fornecer exemplos de corre√ß√£o

## Como me usar:

Ap√≥s fazer altera√ß√µes no c√≥digo, pe√ßa para revisar e eu farei uma an√°lise completa.
```

### Exemplo: API Tester Agent

**Arquivo**: `agents/api-tester.md`

```markdown
---
description: Testa APIs REST e GraphQL
---

# API Tester Agent

Especialista em testar APIs REST e GraphQL.

## Capacidades:

### REST APIs
- GET, POST, PUT, DELETE, PATCH
- Autentica√ß√£o (Bearer, Basic, API Key)
- Headers customizados
- Valida√ß√£o de resposta

### GraphQL
- Queries
- Mutations
- Subscriptions
- Schema validation

## Processo de Teste:

1. **Configura√ß√£o**
   - Endpoint
   - Autentica√ß√£o
   - Headers

2. **Execu√ß√£o**
   - Fazer requisi√ß√µes
   - Medir tempo de resposta
   - Capturar erros

3. **Valida√ß√£o**
   - Status code
   - Response body
   - Response headers
   - Schema validation

4. **Relat√≥rio**
   - Resultados
   - M√©tricas
   - Problemas encontrados

## Exemplo de Uso:

```
Teste a API em https://api.example.com/users
com autentica√ß√£o Bearer e valide:
- Status 200
- Array de usu√°rios
- Cada usu√°rio tem id, name, email
```
```

---

## ü™ù 3. Hooks (Ganchos)

### O que s√£o?

Hooks permitem executar **a√ß√µes autom√°ticas** em momentos espec√≠ficos do ciclo de vida do Claude Code.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ hooks/
    ‚îî‚îÄ‚îÄ hooks.json
```

### Tipos de Hooks (8 no total)

| Hook | Quando Dispara | Uso Comum |
|------|---------------|-----------|
| `user-prompt-submit` | Usu√°rio envia prompt | Valida√ß√£o, logging, modifica√ß√£o |
| `tool-call-before` | Antes de chamar ferramenta | Valida√ß√£o, logging |
| `tool-call-after` | Depois de chamar ferramenta | An√°lise, modifica√ß√£o de resultado |
| `file-edit-before` | Antes de editar arquivo | Backup, valida√ß√£o |
| `file-edit-after` | Depois de editar arquivo | Formata√ß√£o, linting |
| `session-start` | In√≠cio da sess√£o | Configura√ß√£o, logging |
| `session-end` | Fim da sess√£o | Cleanup, relat√≥rios |
| `error` | Quando ocorre erro | Logging, notifica√ß√£o |

### Estrutura do hooks.json

```json
{
  "hooks": [
    {
      "type": "nome-do-hook",
      "command": "comando-a-executar",
      "args": ["arg1", "arg2"],
      "env": {
        "VAR": "valor"
      }
    }
  ]
}
```

### Exemplo: Hook de Valida√ß√£o

**Arquivo**: `hooks/hooks.json`

```json
{
  "hooks": [
    {
      "type": "user-prompt-submit",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/validate-prompt.js"],
      "description": "Valida o prompt do usu√°rio antes de processar"
    }
  ]
}
```

### Exemplo: Hook de Formata√ß√£o Autom√°tica

```json
{
  "hooks": [
    {
      "type": "file-edit-after",
      "command": "prettier",
      "args": ["--write", "${FILE_PATH}"],
      "description": "Formata arquivo automaticamente ap√≥s edi√ß√£o"
    },
    {
      "type": "file-edit-after",
      "command": "eslint",
      "args": ["--fix", "${FILE_PATH}"],
      "description": "Executa ESLint ap√≥s edi√ß√£o"
    }
  ]
}
```

### Exemplo: Hook de Testes Autom√°ticos

```json
{
  "hooks": [
    {
      "type": "file-edit-after",
      "command": "npm",
      "args": ["test", "--", "--testPathPattern=${FILE_PATH}"],
      "description": "Executa testes relacionados ao arquivo editado"
    }
  ]
}
```

### Exemplo Completo com M√∫ltiplos Hooks

```json
{
  "hooks": [
    {
      "type": "session-start",
      "command": "echo",
      "args": ["üöÄ Sess√£o iniciada em $(date)"],
      "description": "Log de in√≠cio de sess√£o"
    },
    {
      "type": "user-prompt-submit",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/log-prompt.js"],
      "env": {
        "LOG_FILE": "${HOME}/.claude/prompts.log"
      },
      "description": "Registra todos os prompts"
    },
    {
      "type": "file-edit-after",
      "command": "prettier",
      "args": ["--write", "${FILE_PATH}"],
      "description": "Formata c√≥digo"
    },
    {
      "type": "file-edit-after",
      "command": "git",
      "args": ["add", "${FILE_PATH}"],
      "description": "Adiciona ao stage automaticamente"
    },
    {
      "type": "error",
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/scripts/log-error.js"],
      "description": "Registra erros"
    },
    {
      "type": "session-end",
      "command": "echo",
      "args": ["‚úÖ Sess√£o finalizada"],
      "description": "Log de fim de sess√£o"
    }
  ]
}
```

### Vari√°veis Dispon√≠veis em Hooks

| Vari√°vel | Dispon√≠vel em | Descri√ß√£o |
|----------|--------------|-----------|
| `${CLAUDE_PLUGIN_ROOT}` | Todos | Raiz do plugin |
| `${FILE_PATH}` | `file-edit-*` | Caminho do arquivo |
| `${TOOL_NAME}` | `tool-call-*` | Nome da ferramenta |
| `${PROMPT}` | `user-prompt-submit` | Prompt do usu√°rio |
| `${ERROR_MESSAGE}` | `error` | Mensagem de erro |

---

## üîó 4. MCP Servers (Model Context Protocol)

### O que s√£o?

MCP Servers conectam **ferramentas e servi√ßos externos** ao Claude Code.

### Configura√ß√£o

Dois formatos poss√≠veis:

#### 4.1. Arquivo .mcp.json (Standalone)

**Localiza√ß√£o**:
```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ .mcp.json
```

**Exemplo**:
```json
{
  "database-tools": {
    "command": "node",
    "args": ["${CLAUDE_PLUGIN_ROOT}/servers/db-server.js"],
    "env": {
      "DATABASE_URL": "${DATABASE_URL}"
    }
  },
  "api-client": {
    "command": "${CLAUDE_PLUGIN_ROOT}/servers/api-mcp",
    "args": ["--verbose"],
    "env": {
      "API_KEY": "${MY_API_KEY}"
    }
  }
}
```

#### 4.2. Inline no plugin.json

**Exemplo**:
```json
{
  "name": "meu-plugin",
  "version": "1.0.0",
  "description": "Plugin com MCP",
  "mcpServers": {
    "database": {
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/servers/db.js"],
      "env": {
        "DB_URL": "${DATABASE_URL}"
      }
    }
  }
}
```

### Exemplo: MCP Server para Banco de Dados

**.mcp.json**:
```json
{
  "postgres": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-postgres"],
    "env": {
      "POSTGRES_URL": "${DATABASE_URL}"
    }
  }
}
```

### Exemplo: MCP Server Personalizado

**Estrutura**:
```
plugins/api-plugin/
‚îú‚îÄ‚îÄ .mcp.json
‚îî‚îÄ‚îÄ servers/
    ‚îî‚îÄ‚îÄ api-mcp/
        ‚îú‚îÄ‚îÄ index.js
        ‚îî‚îÄ‚îÄ package.json
```

**.mcp.json**:
```json
{
  "custom-api": {
    "command": "node",
    "args": ["${CLAUDE_PLUGIN_ROOT}/servers/api-mcp/index.js"],
    "env": {
      "API_BASE_URL": "https://api.example.com",
      "API_KEY": "${MY_API_KEY}"
    }
  }
}
```

**servers/api-mcp/index.js** (simplificado):
```javascript
#!/usr/bin/env node

const MCP = require('@modelcontextprotocol/sdk');

const server = new MCP.Server({
  name: 'custom-api',
  version: '1.0.0'
});

// Registrar ferramenta
server.tool('fetch-data', async (params) => {
  const response = await fetch(
    `${process.env.API_BASE_URL}/data`,
    {
      headers: {
        'Authorization': `Bearer ${process.env.API_KEY}`
      }
    }
  );
  return await response.json();
});

server.start();
```

---

## üéØ 5. Skills (Habilidades para Agentes)

### O que s√£o?

Skills s√£o **capacidades reutiliz√°veis** que podem ser usadas por agentes.

### Localiza√ß√£o

```
plugins/meu-plugin/
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ database-skill/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md
    ‚îî‚îÄ‚îÄ api-skill/
        ‚îî‚îÄ‚îÄ SKILL.md
```

### Estrutura de uma Skill

```markdown
---
description: Descri√ß√£o da skill
---

# Nome da Skill

Descri√ß√£o do que a skill faz e como usar.

## Capacidades:

- Capacidade 1
- Capacidade 2

## Exemplos de Uso:

[Exemplos]
```

### Exemplo: Database Skill

**Arquivo**: `skills/database-skill/SKILL.md`

```markdown
---
description: Skill para interagir com bancos de dados
---

# Database Skill

Fornece capacidades para interagir com diferentes bancos de dados.

## Suporta:

- PostgreSQL
- MySQL
- SQLite
- MongoDB

## Capacidades:

### 1. Executar Queries
```sql
SELECT * FROM users WHERE active = true;
```

### 2. Criar Tabelas
```sql
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  price DECIMAL(10,2)
);
```

### 3. Migrations
- Criar migrations
- Executar migrations
- Rollback migrations

### 4. An√°lise
- Explicar query plans
- Sugerir √≠ndices
- Otimizar queries

## Uso em Agentes:

Agentes podem usar esta skill para:
- Consultar dados
- Modificar esquemas
- Analisar performance
- Gerar relat√≥rios
```

### Exemplo: API Skill

**Arquivo**: `skills/api-skill/SKILL.md`

```markdown
---
description: Skill para trabalhar com APIs REST
---

# API Skill

Capacidades para interagir com APIs REST.

## Capacidades:

### 1. HTTP Methods
- GET - Buscar dados
- POST - Criar recursos
- PUT/PATCH - Atualizar recursos
- DELETE - Remover recursos

### 2. Autentica√ß√£o
- Bearer Token
- API Key
- Basic Auth
- OAuth 2.0

### 3. Formatos
- JSON
- XML
- Form Data
- Multipart

### 4. Valida√ß√£o
- Schema validation
- Status codes
- Response headers
- Error handling

## Exemplo de Uso:

```javascript
// GET request
const users = await api.get('/users', {
  headers: {
    'Authorization': 'Bearer ${API_TOKEN}'
  }
});

// POST request
const newUser = await api.post('/users', {
  body: {
    name: 'Jo√£o',
    email: 'joao@example.com'
  }
});
```

## Integra√ß√£o com Agentes:

Agentes podem usar esta skill para:
- Testar endpoints
- Documentar APIs
- Gerar clientes
- Validar contratos
```

---

## üé® Combinando Componentes

### Exemplo: Plugin Completo de Testes

**Estrutura**:
```
plugins/test-suite/
‚îú‚îÄ‚îÄ .claude-plugin/
‚îÇ   ‚îî‚îÄ‚îÄ plugin.json
‚îú‚îÄ‚îÄ .mcp.json
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ test.md
‚îÇ   ‚îú‚îÄ‚îÄ coverage.md
‚îÇ   ‚îî‚îÄ‚îÄ watch.md
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ test-runner.md
‚îÇ   ‚îî‚îÄ‚îÄ test-generator.md
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ hooks.json
‚îî‚îÄ‚îÄ skills/
    ‚îî‚îÄ‚îÄ testing-skill/
        ‚îî‚îÄ‚îÄ SKILL.md
```

**Fluxo de Uso**:
1. Usu√°rio executa `/test`
2. Comando invoca o **test-runner agent**
3. Agent usa a **testing-skill** para detectar framework
4. Agent usa **MCP server** para executar testes
5. **Hook** `file-edit-after` roda testes automaticamente ap√≥s edi√ß√µes

---

## ‚úÖ Checklist de Componentes

Ao criar um plugin, considere incluir:

### Essencial
- [ ] Pelo menos 1 comando √∫til
- [ ] README.md documentando uso

### Recomendado
- [ ] Agente especializado para tarefa principal
- [ ] Hooks para automa√ß√£o
- [ ] Skills reutiliz√°veis

### Avan√ßado
- [ ] MCP server para integra√ß√µes externas
- [ ] M√∫ltiplos agentes para tarefas complexas
- [ ] Suite completa de hooks

---

## üöÄ Pr√≥ximos Passos

Agora que voc√™ conhece todos os componentes, aprenda a:

‚û°Ô∏è [05 - Publica√ß√£o e Distribui√ß√£o](./05-publicacao-e-distribuicao.md)

---

[‚¨ÖÔ∏è Anterior: Criando um Plugin](./03-criando-plugin.md) | [‚¨ÖÔ∏è Voltar ao √çndice](./README.md) | [‚û°Ô∏è Pr√≥ximo: Publica√ß√£o e Distribui√ß√£o](./05-publicacao-e-distribuicao.md)
